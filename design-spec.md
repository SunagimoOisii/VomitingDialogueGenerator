# 嘔吐セリフジェネレータ 設計仕様

本ドキュメントは、生成仕様をL0〜L3のレイヤーで固定し、実装判断を分離するための設計仕様書。

## レイヤー構成と依存方向
- L0：思想レイヤー(Why)
- L1：表現レイヤー(What)
- L2：制御レイヤー(How)
- L3：実装レイヤー(With what)

上位ほど抽象・不変、下位ほど具体・実装依存。  
依存方向は L3 → L2 → L1 → L0 のみ。


## L0：思想レイヤー(Why)
- 目的: 嘔吐セリフの作成・調整をジェネレータで楽にし、分解して考えるため。
- 良い出力: 生成結果が単調に固定化せず、ユーザー指定の情報・ニュアンスを具体表現に反映すること。
- 良い出力: セリフ長さ／強さ／勢い／苦しさ／方向性／展開の調整ができること。
- 目指さない: 嘔吐以外のシチュエーション。
- 言語ルール/最優先: 明示なし（必要なら追加）。
- 公開方針: 一般公開（十分な確認を入れる）。
- 対象年齢: 年齢表記はせず、注意喚起のみ行う。
- 公開可否の最優先制約: BANされない範囲を維持する。
- 作品の位置づけ: 創作表現としての嗜好・注意喚起が必要であると明記する。
- 免責/責任範囲: 生成内容の受け止めは閲覧者の判断であることを明記する。
- 公開方針の安全制約: 露骨・過度な暴力/グロ表現は避け、回避可能な形で提示する。
- 公開方針の安全制約: 性的に露骨、またはショック目的の性的表現は扱わない。
- 公開方針の安全制約: 個人や集団への攻撃・嫌がらせ・差別的表現は扱わない。
- 公開方針の安全制約: 暴力や身体的危害を美化・称賛する表現は扱わない。
- 公開方針の安全制約: 露骨表現は回避しにくい場所（プロフィール等）に置かない。

## L1：表現レイヤー(What)
- 前兆表現: 吐く前のうめき声（例: うっ…）
- 継続音: 吐いている最中で声にならない部分（例: …っ… / …こっ…）
- 区切り音: 1回の嘔吐が途切れるときの音や声（例: かはっ…）
- 余韻: 嘔吐終了直後の声や息
- 途切れたセリフ: 言おうとした言葉が途中で止まる表現（例: やめろ → やめっ…）
- 警告文: 閲覧注意・創作表現である旨の注意喚起
  - 例: 「このページは嘔吐表現を含みます。閲覧注意。」
  - 例: 「本ページは創作表現です。不快に感じる可能性があります。」
- 免責文: 生成結果の閲覧・利用は自己判断である旨の明記
  - 例: 「生成結果の閲覧・利用は自己判断でお願いします。」
  - 例: 「不快に感じた場合は閲覧を中止してください。」
- 追加注意文: 内容が過度にグロテスクでないこと、回避可能であることの明記
  - 例: 「露骨な描写は避けています。閲覧は任意です。」
  - 例: 「警告に同意するまで内容は表示されません。」
- 必須/禁止: なし

## L2：制御レイヤー(How)
- 入力パラメータ: 吐き気レベル / 文章量 / フレーズ / トーン / 展開
- 影響範囲:
  - 吐き気レベル → 使われる表現（部品内の語彙・強さ）
  - 文章量 → 全体の長さ
  - フレーズ → 任意フレーズ挿入（そのまま or 途切れ表現）
  - トーン → 語彙の重み付けと構成パターンの選択
  - 展開 → 構成パターンの選択（突然/耐えて/連続）
- 吐き気レベル定義（1〜5）:
  - 1（軽い）: 前兆が短い／継続音は短く弱い／区切り音は小さめ／余韻は短い
  - 2（弱め）: 前兆はあり／継続音は短〜中／区切り音は軽い／余韻は短〜中
  - 3（中程度）: 前兆あり／継続音は中／区切り音は明確／余韻は中
  - 4（強い）: 前兆が長め／継続音は長い／区切り音は強め／余韻は長め
  - 5（激しい）: 前兆が強い／継続音は非常に長い／区切り音は強い／余韻は長く荒い
- 文章量定義（短/中/長/超長）:
  - 短: 部品1〜2種で構成（前兆＋継続、または継続＋区切りなど）
  - 中: 部品2〜3種で構成（前兆＋継続＋区切り など）
  - 長: 部品3〜4種で構成（前兆＋継続＋区切り＋余韻）
  - 超長: 部品5〜7種で構成（継続音・余韻を増やして伸ばす）
- フレーズ挿入ルール:
  - 位置: 前兆と継続の間、または継続と区切りの間
  - 形: 「そのまま」か「途切れたセリフ」に変換
  - 挿入数: 最大1回
- 途切れセリフ制御:
  - 途切れ強度の選択（弱/中/強）
  - 分断パターンの有効/無効を切り替え可能
  - 途切れパターンの例は現在フレーズから生成して表示
  - ルールごとの重みをスライダーで調整（偏りなしを初期値とする）
  - UI上は「重み」設定であることを明記する
- 警告画面:
  - 表示条件: 初回アクセス時は必ず表示
  - 再表示条件: 解除されていなければ毎回表示
  - 遷移: 同意ボタン押下で生成画面へ
  - トグル: 「次回から表示しない」を選択可能
  - 回避可能性: 警告に同意するまで生成画面を表示しない
- 共有/保存の制約:
  - 個人情報を入力・保存しない前提
  - 保存データには個人情報を含めない
- 履歴仕様:
  - 最大件数: 50
  - 並び順: 新しい順
  - 削除: 全削除と個別削除
- 部品ごとの語彙差分:
  - 前兆表現: 弱(短い唸り) / 中(短い呻き) / 強(強い呻き・咳き混じり)
  - 継続音: 弱(短い詰まり) / 中(断続的な詰まり) / 強(長い詰まり・濁り)
  - 区切り音: 弱(軽い息) / 中(明確な息・咳) / 強(荒い息・咳き込み)
  - 余韻: 弱(短い息) / 中(整えようとする息) / 強(乱れた息・余韻長め)
  - 途切れたセリフ: 弱(1文字欠け) / 中(1〜2音欠け) / 強(途中で大きく途切れる)
- 繰り返し/強度: レベル指定と文章量に対応
- 組み合わせ順: 前兆 → 継続 → 区切り → 余韻
- フェーズ出現条件: なし

## L3：実装レイヤー(With what)
- 使用言語: HTML / CSS / JavaScript
- データ形式: JSON
- 実装の構成: モジュール分割（拡張性重視、localStorageで保持可能）
- ランダム生成: シード指定あり（指定なしでも生成可能）
- テスト出力: 画面表示
- 保存設計: localStorageに保存するデータに個人情報を含めない
- 共有機能: 実装しない
- セキュリティ対策:
  - 表示はtextContentのみ（innerHTML禁止）
  - CSPでscript-src 'self' を基本とする
  - 外部CDN/スクリプト依存は最小限
  - 入力は長さ制限・危険文字の除去を行う
- モバイルUI: タップハイライトは無効化する
- UI構成: 履歴は出力パネル内の折り畳みに統合する
- UI構成: フレーズは操作パネル内の折り畳みにする
- コメント方針:
  - 「何をしているか」ではなく「なぜそうしているか」を短く補足する
  - 分岐/例外/フォールバック/制限値の理由をコメントで明記する
  - 自明な処理には付けない（代入や単純なDOM取得など）
  - 1ブロックに1コメントを目安に、過剰に細分化しない
  - 例:
    - 良い: 「// 途切れルールが全OFFでも破綻しないよう全候補にフォールバック」
    - 悪い: 「// チェックボックスを取得する」
